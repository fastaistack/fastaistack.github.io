# 访客统计服务启动说明

## 🚀 启动方法

### 方法1：使用启动脚本（推荐）

```bash
cd visitor_counter
python start.py
```

### 方法2：直接运行

```bash
cd visitor_counter
python main.py
```

### 方法3：使用uvicorn命令

```bash
cd visitor_counter
uvicorn main:app --host 0.0.0.0 --port 8081 --reload
```

## 📋 服务地址

- **API服务**: http://localhost:8081
- **Swagger文档**: http://localhost:8081/docs
- **ReDoc文档**: http://localhost:8081/redoc

## 🔧 配置说明

### 修改端口（如需）

编辑 `main.py` 文件，找到最后一行的 `port=8081`：

```python
uvicorn.run(
    "main:app",
    host="0.0.0.0",
    port=8081,  # 修改这里
    reload=True,
    log_level="info"
)
```

### 修改数据存储路径

编辑 `visitor_service.py` 文件，修改初始化参数：

```python
visitor_service = VisitorService(data_file="你的文件路径.json")
```

## ✅ 检查服务是否运行

### 方法1：访问健康检查接口

在浏览器中打开：http://localhost:8081/api/visitor/health

### 方法2：查看API文档

在浏览器中打开：http://localhost:8081/docs

### 方法3：使用curl命令

```bash
curl http://localhost:8081/api/visitor
```

## 🌐 与前端页面配合

1. **确保FastAPI服务运行在8081端口**
2. **启动前端页面（Flask在8080端口）**
3. 访问页面时，会自动调用FastAPI服务进行访客统计
4. 统计数据保存在 `visitor_count.json` 文件中

## 📊 查看统计数据

可以通过以下API查看：

- 获取计数：`GET http://localhost:8081/api/visitor`
- 查看详情：`GET http://localhost:8081/api/visitor/stats`
- 健康检查：`GET http://localhost:8081/api/visitor/health`

## ⚠️ 注意事项

1. **两个服务需要同时运行**：
   - Flask服务（8080端口）- 提供前端页面
   - FastAPI服务（8081端口）- 提供访客统计

2. **CORS问题**：如果遇到跨域问题，已经在main.py中添加了CORS支持

3. **数据文件**：统计数据保存在 `visitor_counter/visitor_count.json` 中

## 🐛 常见问题

### 问题1：端口被占用

错误信息：`OSError: [Errno 48] Address already in use`

**解决方案**：修改端口号或关闭占用端口的程序

### 问题2：模块未找到

错误信息：`ModuleNotFoundError: No module named 'fastapi'`

**解决方案**：安装依赖
```bash
pip install -r requirements.txt
```

### 问题3：跨域问题

确保在 `main.py` 中已经正确配置了CORS中间件
